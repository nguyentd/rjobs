#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.dirname(__FILE__) + '/../lib') unless $LOAD_PATH.include?(File.dirname(__FILE__) + '/../lib')

require 'trollop'
require "rjobs/jobs_file"
require "rjobs/job"
require "rjobs/job_handler"
require 'rjobs/cli_helper'
include  Rjobs::CliHelper   

p = Trollop::Parser.new do
  banner <<-EOS
Harvest all finished jobs described in the jobs file.

Usage:
       rjharvest [options] <filename>
where [options] are:
EOS
  
end

opts = Trollop::with_standard_exception_handling p do
  o = p.parse ARGV
  raise Trollop::HelpNeeded if ARGV.empty? # show help screen
end

jobs_file = ARGV[0]

jobs = get_jobs_info(jobs_file)
jobs.each do |job| 
  Rjobs::JobHandler.get_job_results(job)        
end        

